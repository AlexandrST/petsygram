{% extends "photo_blog/base.html" %}
{% block content %}



<div class="content">
  {% for post in object_list %}
    {% if post.author != user and user in post.author.profile.followers.all %}
      <article class="media content-section">
          <div class="media-body">
            <div class="article-metadata">
              <div>
                <img class='rounded-circle article-img'src="{{ post.author.profile.image.url }}" height="50" width="50">
                <a class="black-link" href="{% url 'photo_blog-profile' post.author.username %}">{{ post.author }}</a>
                {% if post.location %}
                  <small>{{ post.location }}</small>
                {% endif %}
              </div>
              <img class="img-fluid img-thumbnail" src="{{ post.photo.url }}">


              <script type="text/javascript">
                function toggleLike{{post.id}}(){
                      $.ajax({
                        url: "{% url 'photo_blog-post_like_api' post.id %}",
                        success: function(data) {
                          $("#likeCount{{post.id}}").html(data.like_count + ' likes');
                          $('#imageElement{{post.id}}').html(data.img);
                        }
                        });
                    };
              </script>


              {% if user in post.likes.all %}
                <a id=imageElement{{post.id}}  onclick="toggleLike{{post.id}}()"><img src="/media/nav_buttons/liked.svg" height="17" width="17"></a>
              {% else %}
                <a id=imageElement{{post.id}}  onclick="toggleLike{{post.id}}()"><img src="/media/nav_buttons/unliked.svg" height="17" width="17"></a>
              {% endif %}
              <a href="{% url 'photo_blog-comment' post.id %}"><img src="/media/nav_buttons/comment.svg" height="17" width="17"></a></br>
              <a id=likeCount{{post.id}} class="black-link-plain mb-3" href="{% url 'photo_blog-post_likes' post.id %}">{{post.likes.count}} likes</a>


              <p>
                <a class="black-link" href="{% url 'photo_blog-profile' post.author.username %}">{{ post.author }}</a>
                {{ post.caption }}
              </p>
              {% if post.comments.all %}
                <p>
                  <a class="black-link" href="{% url 'photo_blog-profile' post.comments.first.author.username %}">{{ post.comments.first.author }}</a>
                  {{ post.comments.first|truncatechars:50 }}
                </p>
              {% endif %}
              {% if post.comments.all %}
                <a href="{% url 'photo_blog-detail' post.id %}">View Comments</a>
              {% endif %}
              <p><small>{{ post.date_posted|date:'F d, Y' }}</small></p>
            </div>
          </div>
      </article>
    {% endif %}
  {% endfor %}
  <div>
    {% if page_obj.has_previous %}
      <a class="infinite-more-link" href="?page={{ page_obj.previous_page_number }}">Less</a>
    {% endif %}
    {% if page_obj.has_next %}
      <a class="infinite-more-link" href="?page={{ page_obj.next_page_number }}">More</a>
    {% endif %}
  </div>
</div>

{% endblock %}
